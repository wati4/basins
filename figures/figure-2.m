(* for a *)
(* adapted from niches/general/math/figures-2.m *)

(* with line, no contours *)
graph2[a_, x1_, x2_, y1_, y2_] :=
 Show[      StreamPlot[{x (1-a x-2 y), y (1-y-2x)},{x, x1, x2},{y, y1, y2},
                                 AspectRatio -> (y2-y1)/(x2-x1),
             AxesLabel-> {n1, n2}, 
        LabelStyle ->{FontSize -> 13}],
       Graphics[{Line[{{0, -0.1}, {0, 1.3}}], Line[{{-0.1, 0},{1.3,0}}],
            Text[Style[ToExpression["n_1", TeXForm], 14],{x2, 0}],
            Text[Style[ToExpression["n_2", TeXForm], 14],{-0.06, y2+0.05}],
        RGBColor[1, 0, 0], Circle[{1/(4-a),(2-a)/(4-a)}, (x2-x1)/50.0],
                Disk[{1/a, 0}, (x2-x1)/50.0],
                Disk[{0, 1}, (x2-x1)/50.0], Line[{{0,0},{1/(2-a),1}}]
}]]


figure[2, 1] := Export["figure-2a.pdf",graph2[0.7, 0, 1.7, 0, 1.0]]

(* for b *)

graph[2, 2] :=
 Plot[2 ArcTan[2-1/p]/Pi,{p, 0.5, 10}, PlotRange ->{{0,   5},{0, 1}},
    AxesLabel ->{ToExpression["P_1", TeXForm], 
                ToExpression["D_1", TeXForm]}, 
        LabelStyle ->{FontSize -> 15}]

figure[2, 2] := Export["figure-2b.pdf",graph[2, 2]]

(* for c, d *)

(* do 3D geometric approximation *) 

solid3[a_, b_, c_] :=
  With[{aa = Norm[a], bb = Norm[b], cc = Norm[c]},
        2 ArcTan[Det[{a, b, c}]/(aa bb cc + aa (b.c) + bb (a.c) + cc (a.b))]]

answer3[a_] := Apply[solid3, basis[3, a]]*(4/Pi)

basis[d_, i_, a_] :=Table[If[j == 1, 1, If[j <= i, 2-a, 0]],{j, 1, d}]
basis[d_, a_] :=Table[basis[d, i, a],{i, 1, d}]

graph[2, 3] :=
  Show[Plot[answer3[1/a],{a, 0.5, 5}, PlotRange ->{{0,   3},{0, 0.8}},
          AxesLabel-> {ToExpression["P_1", TeXForm], 
                ToExpression["D_1", TeXForm]}, 
        LabelStyle ->{FontSize -> 15}],
       ListPlot[data[3], PlotStyle -> Red]]

figure[2, 3] := Export["figure-2c.pdf",graph[2, 3]]

(* 3D data *)

data[3] =
 {{0.05000000000000002, 0.}, {0.10000000000000003, 0.}, {0.14999999999992497, 
 0.}, {0.20000000000000007, 0.}, {0.25, 0.}, {0.30000000000029997, 0.}, 
 {0.35000000000034986, 0.}, {0.40000000000000013, 0.}, {0.4500000000004498, 
 0.}, {0.5, 0.}, {0.5499999999999449, 0.020326274400488006}, 
 {0.59999999999988, 0.06398743303888837}, {0.6499999999998051, 
 0.11232135820494188}, {0.7000000000002102, 0.15814111111111112}, 
 {0.7500000000001878, 0.1992731990639813}, {0.8000000000000003, 
 0.23322855245993812}, {0.8500000000002127, 0.2646529411764705}, 
 {0.9000000000000904, 0.28964}, {0.9499999999999714, 0.31330499999999994}, 
 {1., 0.33351722414448287}, {1.0499999999999476, 0.3503572883621227}, 
 {1.100000000000011, 0.36573722764981614}, {1.1500000000004027, 
 0.3790708239377004}, {1.20000000000048, 0.38971337331226685}, {1.25, 
 0.40090488363766325}, {1.2999999999996101, 0.4084900495192865}, 
 {1.3499999999995278, 0.41940156322577116}, {1.3999999999994406, 
 0.4296598793887064}, {1.4499999999995654, 0.4350726315789474}, 
 {1.4999999999992502, 0.44171988197422624}, {1.5499999999989922, 
 0.44889473684210524}, {1.6000000000000005, 0.45488736842105276}, 
 {1.649999999998927, 0.45882327457215816}, {1.6999999999989799, 
 0.4634610321095311}, {1.7499999999986877, 0.46790493685873724}, 
 {1.799999999998561, 0.4721994137438305}, {1.8499999999984276, 
 0.4767693475869518}, {1.8999999999988606, 0.48033857142857145}, 
 {1.949999999998148, 0.48247625000000005}, {2., 0.4866141966628806}}

data[20] =
{{0.05, 0.}, {0.1, 0.00001}, {0.149999999999925, 0.}, {0.2, 0.}, {0.25, 0.}, 
 {0.3000000000002999, 0.}, {0.35000000000035003, 0.}, {0.4, 0.}, 
 {0.45000000000045, 0.}, {0.5, 0.}, {0.549999999999945, 0.}, 
 {0.59999999999988, 0.00004706353035312945}, 
 {0.6499999999998052, 0.00028000600120024006}, 
 {0.70000000000021, 0.0024000500100020005}, 
 {0.7500000000001875, 0.006021157915793685}, {0.8, 0.012860494098819763}, 
 {0.8500000000002125, 0.021778440216966073}, 
 {0.9000000000000902, 0.03016939177309146}, 
 {0.9499999999999716, 0.04023200850696455}, {1., 0.04885471410071488}, 
 {1.0499999999999479, 0.06072754129773323}, 
 {1.100000000000011, 0.06856070161400701}, {1.1500000000004025, 
  0.07770152630526105}, {1.2000000000004802, 0.08523721450172388}, 
 {1.25, 0.09327567618786915}, {1.2999999999996104, 0.10233892462703068}, 
 {1.3499999999995276, 0.11043331066213243}, 
 {1.3999999999994401, 0.11463404891504617}, 
 {1.449999999999565, 0.12206938721077548}, 
 {1.49999999999925, 0.12921542086195018}, {1.5499999999989926, 
  0.1326665568915264}, {1.6, 0.13717129825965194}, 
 {1.6499999999989274, 0.1445375}, {1.69999999999898, 0.14740355365190685}, 
 {1.7499999999986875, 0.1545546615205394}, 
 {1.79999999999856, 0.1583149049809962}, {1.8499999999984276, 
  0.1601832926585317}, {1.89999999999886, 0.1629866220030721}, 
 {1.9499999999981477, 0.16903}, {2., 0.1721388988908893}}

<< cx-20.m

cf3 = Map[{#[[1]], #[[2]]/100000.0} &, cx3];
cf9 = Map[{#[[1]], #[[2]]/100000.0} &, cx9];

graph[2, 4] :=
  Show[ListPlot[data[20], PlotStyle -> Black, PlotRange ->{{0, 3},{0, 0.3}},
          AxesLabel-> {ToExpression["P_1", TeXForm], 
                ToExpression["D_1", TeXForm]}, 
        LabelStyle ->{FontSize -> 15}],
        ListPlot[cf3, PlotStyle -> Red],ListPlot[cf9, PlotStyle -> Blue]]

figure[2, 4] := Export["figure-2d.pdf",graph[2, 4]]

(* looking at results of simulations with evenly spaced S= 20
 from niches/math/diagonal.m,  data from tally-diagonal-20.m *)

tally = {{1, 19290}, {2, 16887}, {3, 14354}, {4, 12152}, {5, 10210}, {6, 8151}, 
 {7, 6295}, {8, 4643}, {9, 3351}, {10, 2171}, {11, 1300}, {12, 757}, 
 {13, 296}, {14, 111}, {15, 26}, {16, 6}}

(* extends a tally to include all numbers to limit *)

extend[t_, n_] :=
 Table[With[{p = Position[Map[First, t], i]},
        If[p =={},{i, 0}, t[[p[[1, 1]]]]]],{i, 1, n}]

diagonal[size_, a1_, ak_] :=
 Table[Table[If[i == j, a1 + (i -1)*(ak-a1)/(size -1), 2],
  {i, 1, size}],{j, 1, size}]

graph[2, 5] :=
  With[{ds=Table[diagonal[20, 0.5, 2][[i, i]],{i, 1, 20}],
        x = extend[tally, 20]},
    t = Map[#[[2]] &, x]/Apply[Plus, x][[2]];
    ListPlot[Table[{1/ds[[i]], t[[i]]},{i, 1, 20}],
          AxesLabel-> {ToExpression["P_1", TeXForm], 
                ToExpression["D_1", TeXForm]}, 
        LabelStyle ->{FontSize -> 15}]]


figure[2, 5] := Export["figure-2e.pdf",graph[2, 5]]
